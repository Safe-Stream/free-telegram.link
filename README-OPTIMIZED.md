# üöÄ Free Telegram Proxy - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è 8-—è–¥–µ—Ä–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

## üìù –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –í–µ—Ä—Å–∏—è 2.0 - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–Ω–æ–≥–æ—è–¥–µ—Ä–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤

**–û—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- ‚úÖ **1 –ø–æ—Ä—Ç** (8443) –≤–º–µ—Å—Ç–æ 4 - —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ **4 worker'–∞** (`-M 4`) –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö 8 —è–¥–µ—Ä
- ‚úÖ **–°–∏—Å—Ç–µ–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å mtproxy** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
- ‚úÖ **Before=docker.service** - MTProxy –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–æ Docker, –∏–∑–±–µ–≥–∞—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å bridge-—Å–µ—Ç—è–º–∏
- ‚úÖ –£–±—Ä–∞–Ω Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä MTProxy - —Ç–æ–ª—å–∫–æ systemd
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è - –ª–µ–≥—á–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å

### –ß—Ç–æ –±—ã–ª–æ —É–±—Ä–∞–Ω–æ:
- ‚ùå Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä MTProxy (–≤—ã–∑—ã–≤–∞–ª –ø—Ä–æ–±–ª–µ–º—ã —Å binding)
- ‚ùå –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ—Ä—Ç—ã 2222,4444,3333,5555 (–∏–∑–ª–∏—à–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å)
- ‚ùå Systemd template services (—É–ø—Ä–æ—â–µ–Ω–æ –¥–æ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞)

---

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
cd /opt
git clone https://github.com/safe-stream/free-telegram.link.git
cd free-telegram.link
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env
```bash
cp .env.example .env
nano .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
```env
MTPROXY_SECRET=      # –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
LETSENCRYPT_EMAIL=your-email@example.com
DOMAIN=your-domain.com
```

### 3. –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
```bash
chmod +x install.sh update.sh
./install.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Docker, build tools)
- –°–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç MTProxy –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤
- –°–æ–∑–¥–∞—Å—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `mtproxy`
- –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π SECRET
- –°–æ–∑–¥–∞—Å—Ç systemd —Å–µ—Ä–≤–∏—Å —Å **4 worker'–∞–º–∏**
- –ü–æ–ª—É—á–∏—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- –ó–∞–ø—É—Å—Ç–∏—Ç nginx + certbot –≤ Docker

---

## üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
systemctl status mtproxy
journalctl -u mtproxy -f
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
```bash
systemctl restart mtproxy
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
journalctl -u mtproxy -n 100 --no-pager
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤
```bash
ss -tlnp | grep 8443
lsof -i :8443
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. MTProxy –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
id mtproxy

# –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç:
useradd -r -s /bin/false mtproxy
chown -R mtproxy:mtproxy /opt/mtproxy

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å
systemctl restart mtproxy
```

### 2. –ü–æ—Ä—Ç 8443 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω —Å–Ω–∞—Ä—É–∂–∏
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
nc -zv localhost 8443

# –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ firewall –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
# –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç 8443/TCP –≤ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–∏–Ω–≥–æ–º
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ worker'–æ–≤
```bash
ps aux | grep mtproto-proxy
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 2 –ø—Ä–æ—Ü–µ—Å—Å–∞: –≥–ª–∞–≤–Ω—ã–π + 4 worker'–∞
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å Telegram
```bash
# –ù–∞–π–¥–∏—Ç–µ PID –ø—Ä–æ—Ü–µ—Å—Å–∞
PID=$(pgrep mtproto-proxy | head -1)

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
lsof -p $PID | grep TCP | grep ESTABLISHED
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫:
- `91.108.x.x` (Telegram DC)
- `149.154.x.x` (Telegram DC)

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è systemd

–§–∞–π–ª: `/etc/systemd/system/mtproxy.service`

```ini
[Unit]
Description=MTProxy - Telegram Proxy
After=network.target
Before=docker.service

[Service]
Type=simple
User=mtproxy
Group=mtproxy
EnvironmentFile=/opt/free-telegram.link/.env
ExecStart=/usr/local/bin/mtproto-proxy -p 8443 -S ${MTPROXY_SECRET} --aes-pwd /opt/mtproxy/proxy-secret /opt/mtproxy/proxy-multi.conf -M 4
Restart=on-failure
RestartSec=5s
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `-M 4` - 4 worker'–∞ –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è 8-—è–¥–µ—Ä–Ω–æ–≥–æ CPU
- `User=mtproxy` - –∑–∞–ø—É—Å–∫ –æ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ root)
- `Before=docker.service` - –∑–∞–ø—É—Å–∫ –¥–æ Docker, –∏–∑–±–µ–≥–∞—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å bridge

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
cd /opt/free-telegram.link
./update.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –û–±–Ω–æ–≤–∏—Ç –∫–æ–¥ –∏–∑ GitHub
- –ü–µ—Ä–µ—Å–æ–±–µ—Ä—ë—Ç MTProxy
- –û–±–Ω–æ–≤–∏—Ç Docker –æ–±—Ä–∞–∑—ã
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã

---

## üåê –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Proxy Link
```
tg://proxy?server=YOUR-DOMAIN&port=8443&secret=ddYOUR_SECRET
```

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–µ—Ñ–∏–∫—Å `dd` –ø–µ—Ä–µ–¥ SECRET!

### –í–µ–±-—Å–∞–π—Ç
```
https://YOUR-DOMAIN
```

–ù–∞ —Å–∞–π—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è QR-–∫–æ–¥ –∏ –∫–Ω–æ–ø–∫–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "cannot change user to (none)"
**–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `mtproxy`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
useradd -r -s /bin/false mtproxy
chown -R mtproxy:mtproxy /opt/mtproxy
systemctl restart mtproxy
```

### –ü—Ä–æ–±–ª–µ–º–∞: MTProxy –±–∏–Ω–¥–∏—Ç—Å—è –∫ 172.17.0.1 (Docker bridge)
**–ü—Ä–∏—á–∏–Ω–∞:** Docker –∑–∞–ø—É—â–µ–Ω –¥–æ MTProxy

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ `Before=docker.service` –≤ systemd unit

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ä—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω —Å–Ω–∞—Ä—É–∂–∏
**–ü—Ä–∏—á–∏–Ω–∞:** Firewall –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—Ä—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç 8443/TCP –≤ –ø–∞–Ω–µ–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç 443:
```bash
sed -i 's/-p 8443/-p 443/' /etc/systemd/system/mtproxy.service
sed -i 's/8443/443/g' nginx/html/config.js
systemctl daemon-reload
systemctl restart mtproxy
docker compose restart nginx
```

### –ü—Ä–æ–±–ª–µ–º–∞: DDoS –∞—Ç–∞–∫–∞
**–°–∏–º–ø—Ç–æ–º—ã:** –ü–æ—Ç–µ—Ä–∏ –ø–∞–∫–µ—Ç–æ–≤, —Ä–∞–∑—Ä—ã–≤—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞

**–í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ä—ã:**
```bash
# –í–∫–ª—é—á–∏—Ç–µ SYN cookies
sysctl -w net.ipv4.tcp_syncookies=1

# –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
iptables -A INPUT -p tcp --dport 8443 -m connlimit --connlimit-above 100 -j REJECT

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
watch -n 1 'ss -s'
```

**–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CloudFlare –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π DDoS-protection —Å–µ—Ä–≤–∏—Å

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞–≥—Ä—É–∑–∫–∏
```bash
# CPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
top -p $(pgrep mtproto-proxy | head -1)

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
ss -s | grep tcp

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ MTProxy (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω -v verbose)
journalctl -u mtproxy -f | grep stats
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

1. **–£–≤–µ–ª–∏—á—å—Ç–µ worker'—ã:**
```bash
sed -i 's/-M 4/-M 8/' /etc/systemd/system/mtproxy.service
systemctl daemon-reload && systemctl restart mtproxy
```

2. **–í–∫–ª—é—á–∏—Ç–µ TCP BBR** (—É–∂–µ –≤–∫–ª—é—á–µ–Ω–æ –Ω–∞ Ubuntu 24.04):
```bash
echo "net.core.default_qdisc=fq" >> /etc/sysctl.conf
echo "net.ipv4.tcp_congestion_control=bbr" >> /etc/sysctl.conf
sysctl -p
```

3. **–£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç—ã:**
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ /etc/systemd/system/mtproxy.service
[Service]
LimitNOFILE=65536
```

---

## üìù Changelog

### v2.0 (–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è)
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è 8-—è–¥–µ—Ä–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤ (`-M 4`)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- –£–±—Ä–∞–Ω Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä MTProxy
- –£–ø—Ä–æ—â–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ 1 –ø–æ—Ä—Ç–∞
- –î–æ–±–∞–≤–ª–µ–Ω `Before=docker.service`

### v1.0 (–°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è)
- 4 –ø–æ—Ä—Ç–∞ (2222,4444,3333,5555)
- Docker + systemd template
- 1 worker –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [MTProxy GitHub](https://github.com/TelegramMessenger/MTProxy)
- [Telegram Proxy Documentation](https://core.telegram.org/mtproto/mtproto-transports#transport-obfuscation)
- [Let's Encrypt](https://letsencrypt.org/)

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. `systemctl status mtproxy` - —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
2. `journalctl -u mtproxy -n 50` - –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
3. `ss -tlnp | grep 8443` - —Å–ª—É—à–∞–µ—Ç—Å—è –ª–∏ –ø–æ—Ä—Ç
4. `id mtproxy` - —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ –¥–ª—è –ª–∏—á–Ω—ã—Ö –∏ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö —Ü–µ–ª–µ–π.
